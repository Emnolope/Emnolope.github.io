<!DOCTYPE html>
<html>
<head>
  <title>Inventory App</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    .mode { display: none; }
    .mode.active { display: block; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; }
    #modeBtn { position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 10px; }
    #camera { width: 100vw; height: 100vh; object-fit: cover; cursor: pointer; }
    .placeholder { display: flex; align-items: center; justify-content: center; font-size: 3em; background: #333; color: white; }
  </style>
</head>
<body>
  <div id="app">
    <div id="mode0" class="mode">
      <video id="camera" autoplay playsinline onclick="savePhoto(capturePhoto())"></video>
    </div>
    <div id="mode1" class="mode placeholder">SLOW PICTURE MODE</div>
    <div id="mode2" class="mode placeholder">GALLERY VIEW</div>
    <div id="mode3" class="mode placeholder">TABLE VIEW</div>
    <div id="mode4" class="mode placeholder">
      <button onclick="pickFolder()">Pick Folder</button>
      <div id="output"></div>
    </div>
  </div>
  <button id="modeBtn" onclick="nextMode()"></button>
  <script>
// GLOBAL STATE
let dirHandle;
////// I/O OPERATIONS //////
async function listFiles() {
  const files = [];
  for await (const [name, handle] of dirHandle.entries()) {
    if (handle.kind === 'file') files.push(name);
  }
  return files;
}
async function readFile(filename) {
  const handle = await dirHandle.getFileHandle(filename);
  return await handle.getFile();
}
async function writeFile(filename, data) {
  const handle = await dirHandle.getFileHandle(filename, {create: true});
  const writer = await handle.createWritable();
  await writer.write(data);
  await writer.close();
}
async function deleteFile(filename) {
  await dirHandle.removeEntry(filename);
}
////// CAMERA //////
async function startCamera() {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({video: true});
    document.getElementById('camera').srcObject = stream;
  } catch(e) { log('Camera failed:', e); }
}
function capturePhoto() {
  const canvas = document.createElement('canvas');
  const video = document.getElementById('camera');
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext('2d').drawImage(video, 0, 0);
  return canvas.toDataURL('image/jpeg');
}
////// UI OPERATIONS //////
const modes = ['üì∏', 'üêå', 'üñºÔ∏è', 'üìä', '‚öôÔ∏è'];
let currentMode = 0;

function nextMode() {
  currentMode = (currentMode + 1) % modes.length;
  render();
}
function render() {
  document.querySelectorAll('.mode').forEach(m => m.classList.remove('active'));
  document.getElementById(`mode${currentMode}`).classList.add('active');
  document.getElementById('modeBtn').textContent = modes[currentMode];
}
function log(msg) {
  document.getElementById('output').innerHTML += `<div>${msg}</div>`;
}
function parseFilename(filename) {
  const lastDot = filename.lastIndexOf('.');
  const name = lastDot > 0 ? filename.slice(0, lastDot) : filename;
  const ext = lastDot > 0 ? filename.slice(lastDot) : '';
  return { name, ext, original: filename };
}
function generateFilename(metadata) {
  return `${metadata.name}${metadata.ext}`;
}
function transformName(metadata, rule) {
  if (rule === 'reverse') {
    return { ...metadata, name: metadata.name.split('').reverse().join('') };
  }
  return metadata;
}
////// HIGH LEVEL //////
async function pickFolder() {
  try {
    dirHandle = await window.showDirectoryPicker();
    log('üìÅ Folder selected');
    const inventory = await loadInventory();
    log(`üìÑ Found: [${inventory.map(i => i.original).join(', ')}]`);
  } catch (e) {
    log(`‚ùå ${e.message}`);
  }
}
async function savePhoto(imageData) {
  if (!dirHandle) {
    log('No folder selected');
    return;
  }
  const filename = `photo_${Date.now()}.jpg`;
  const response = await fetch(imageData);
  const blob = await response.blob();
  await writeFile(filename, blob);
  log(`üì∏ Saved: ${filename}`);
}

async function loadInventory() {
  const filenames = await listFiles();
  return filenames.map(parseFilename);
}
async function updateInventoryItem(oldFilename, transformation) {
  const oldMetadata = parseFilename(oldFilename);
  const newMetadata = transformName(oldMetadata, transformation);
  const newFilename = generateFilename(newMetadata);
  const fileData = await readFile(oldFilename);
  await writeFile(newFilename, fileData);
  await deleteFile(oldFilename);
  return { old: oldFilename, new: newFilename };
}
window.onload = function init() {
  render();
  startCamera();
}
  </script>
</body>
</html>
